%	Base de conhecimento

:-dynamic liga/3.

linha(1, ['Château de Vincennes', 'Bérault', 'Saint-Mandlé-Tourelle', 'Porte de Vincennes', 'Nation', 'Reuilly-Diderot', 'Gare de Lyon', 'Bastille', 'Saint-Paul', 'Hotel de Ville', 'Châtelet', 'Louvre-Rivoli', 'Palais Royal-Museé du Louvre', 'Tuileries', 'Concorde', 'Champs-Élysées-Clemenceau', 'Franklin D.Roosevelt', 'George V', 'Charles de Gaulle - Étoile', 'Argentine', 'Porte Maillot', 'Les Sablons', 'Pont de Neuilly', 'Esplanade de La Défense', 'La Défense']).

linha(2, ['Porte Dauphine', 'Victor Hugo', 'Charles de Gaulle Étoile', 'Ternes', 'Courcelles', 'Monceau', 'Villiers', 'Rome', 'Place de Clichy', 'Blanche', 'Pigalle', 'Anvers', 'Barbès-Rochechouart', 'La Chapelle', 'Stalingrad', 'Jaurès', 'Colonel Fabien', 'Belleville', 'Couronnes', 'Ménilmontant', 'Père Lachaise', 'Philippe Auguste', 'Alexandre Dumas', 'Avron', 'Nation']).

linha(3, ['Pont de Levallois Bécon', 'Anatole France', 'Louise Michel', 'Porte de Champerret', 'Pereire', 'Wagram', 'Malesherbes', 'Villiers', 'Europe', 'Saint-Lazare', 'Havre-Caumartin', 'Opéra', 'Quatre-Septembre', 'Bourse', 'Sentier', 'Réamur-Sébastopol', 'Arts et Métiers', 'Temple', 'République', 'Parmentier', 'Rue Saint-Maur', 'Père Lachaise', 'Gambetta', 'Porte de Bagnolet', 'Gallieni']).

linha('3bis',['Gambetta','Pelleport','Saint-Fargeau','Porte des Llias']).

linha(4, ['Porte de Clignancourt', 'Simplon', 'Marcadet Poissonniers', 'Château Rouge', 'Barbès-Rochechouart', 'Gare du Nord', 'Gare de lEst', 'Château dEau', 'Strasbourg Saint-Denis', 'Réamur-Sébastopol', 'Étienne Marcel', 'Les Halles', 'Châtelet', 'Cité', 'Saint-Michel', 'Odéon', 'Saint-Germain-des-Prés', 'Saint-Sulpice', 'Saint-Placide', 'Montparnasse Bienvenue', 'Vavin', 'Raspail', 'Denfert-Rochereau', 'Mouton-Duvernet', 'Alésia', 'Porto dOrléans']).

linha(5, ['Bobigny Pablo Picasso', 'Bobigny-Pantin', 'Hoche', 'Porte de Pantin', 'Ourcq', 'Laumière', 'Jaurès', 'Stalingrad', 'Gare du Nord', 'Gare de lEst', 'Jacques Bonsergent', 'République', 'Oberkampf', 'Richard-Lenoir', 'Bréguet-Sabin', 'Bastille', 'Quai de la Rapée', 'Gare dAusterlitz', 'Saint-Marcel', 'Campo-Formio', 'Place dItalie']).

linha(6, ['Charles de Gaulle Étoile', 'Kléber', 'Boissière', 'Trocadéro', 'Passy', 'Bir-Hakeim', 'Dupleix', 'La Motte-Picquet Grenelle', 'Cambronne', 'Sèvres-Lecourbe', 'Pasteur', 'Montparnasse Bienvenue', 'Edgar Quinet', 'Raspail', 'Denfert-Rochereau', 'Saint-Jacques', 'Glacière', 'Corvisart', 'Place dItalie', 'Nationale', 'Chevaleret', 'Quai de la Gare', 'Bercy', 'Dugommier', 'Daumesnil', 'Bel-Air', 'Picpus', 'Nation']).

linha(7,['La Courneuve 8 Mai 1945', 'Fort dAubervilliers', 'Aubervilliers-Pantin Quatre Chemins', 'Porte de la Villette', 'Corentin Cariou', 'Crimée', 'Riquet', 'Stalingrad', 'Louis Blanc', 'Château-Landon', 'Gare de lEst', 'Poissonnière', 'Cadet', 'Le Peletier', 'Chaussée dAntin-La Fayette', 'Opéra', 'Pyramides', 'Palais Royal', 'Musée du Louvre', 'Pont Neuf', 'Châtelet', 'Pont Marie', 'Sully-Morland', 'Jussieu', 'Place Monge', 'Censier-Daubenton', 'Les Gobelins', 'Place dItalie', 'Tolbiac', 'Maison Blanche', 'Porte dItalie', 'Porte de Choisy', 'Porte dIvry', 'Pierre Curie', 'Mairie dIvry']).

linha('7bis',['La Courneuve 8 Mai 1945', 'Fort dAubervilliers', 'Aubervilliers-Pantin Quatre Chemins', 'Porte de la Villette', 'Corentin Cariou', 'Crimée', 'Riquet', 'Stalingrad', 'Louis Blanc', 'Château-Landon', 'Gare de lEst', 'Poissonnière', 'Cadet', 'Le Peletier', 'Chaussée dAntin-La Fayette', 'Opéra', 'Pyramides', 'Palais Royal', 'Musée du Louvre', 'Pont Neuf', 'Châtelet', 'Pont Marie', 'Sully-Morland', 'Jussieu', 'Place Monge', 'Censier-Daubenton', 'Les Gobelins', 'Place dItalie', 'Tolbiac', 'Maison Blanche', 'Le Kremlin-Bicêtre', 'Villejuif Léo-Lagrange', 'Villejuif Paul Vaillant-Couturier', 'Villejuif Louis Aragon']).

linha(8, ['Ballard', 'Lourmel', 'Boucicaut', 'Félix Faure', 'Commerce', 'La Motte-Picquet-Grenelle', 'École Militaire', 'La Tour-Maubourg', 'Invalides', 'Concorde', 'Madeleine', 'Opéra', 'Richelieu-Drouot', 'Grands Boulevards', 'Bonne Nouvelle', 'Strasbourg-Saint-Dennis', 'République', 'Filles du Calvaire', 'Saints-Sébastien-Froissart', 'Chemin Vert', 'Bastille', 'Ledru-Rollin', 'Faidherbe-Chaligny', 'Reuilly-Diderot', 'Montgallet', 'Daumesnil', 'Michel Bizot', 'Porte Dorée', 'Porte de Charenton', 'Liberté', 'Charenton-Écoles', 'École Vétérinaire de Maisons-Alfort', 'Maisons-Alfort-Stade', 'Maisons-Alfort-Les Juilliottes', 'Créteil-LÉchat', 'Créteil-Université', 'Créteil-Préfecture']).

linha(9, ['Pont de Sèvres', 'Billancourt', 'Marcel Sembat', 'Porte de Saint-Cloud', 'Exelmans', 'Michel-Ange-Auteuil', 'Jasmin', 'Ranelagh', 'La Muette', 'Rue de la Pompe', 'Trocadéro', 'Iéna', 'Alma-Marceau', 'Franklin D.Roosevelt', 'Saint-Philippe-du-Roule', 'Miromesnil', 'Saint-Augustin', 'Havre-Caumartin', 'Chaussée dAntin-La Fayette', 'Richelieu-Drouot', 'Grands Boulevards', 'Bonne Nouvelle', 'Strasbourg-Saint-Dennis', 'République', 'Oberkampf', 'Saint-Ambroise', 'Voltaire', 'Charonne', 'Rue des Boulets', 'Nation', 'Buzenval', 'Maraichers', 'Porte de Montreuil', 'Robespierre', 'Croix de Chavaux', 'Mairie de Montreuil']).

linha(10, ['Boulogne Pont de Saint-Cloud', 'Boulogne Jean Jaurès', 'Michel-Ange Molitor', 'Chardon Lagache', 'MiraBeau', 'Javel-André Citroen', 'Charles Michels', 'Avenue Émile Zola', 'La Motte-Picquet Grenelle', 'Ségur', 'Duroc', 'Vaneau', 'Sèvres-Babylone', 'Mabillon', 'Odéon', 'Cluny-La Sorbonne', 'Maubert-Mutualité', 'Cardinal Lemoine', 'Jussieu', 'Gare dAusterlitz']).

linha(10.2, ['Boulogne Pont de Saint-Cloud', 'Boulogne Jean Jaurès', 'Port dAuteuil', 'Michel-Ange-Auteuil', 'Église dAuteuil', 'Javel-André Citroen', 'Charles Michels', 'Avenue Émile Zola', 'La Motte-Picquet Grenelle', 'Ségur', 'Duroc', 'Vaneau', 'Sèvres-Babylone', 'Mabillon', 'Odéon', 'Cluny-La Sorbonne', 'Maubert-Mutualité', 'Cardinal Lemoine', 'Jussieu', 'Gare dAusterlitz']).

linha(11, ['Châtelet','Hôtel de Ville','Rambuteau','Goncourt','Belleville','Pyrénées','Jourdain','Place des Fêtes','Télégraphe','Mairie des Llias']).

linha(12,['Front Populaire','Porte de la Chapelle','Marx Dormoy','Marcadet Poissonniers','Jules Joffrin','Lamarck Caulaincourt','Abbesses','Pigalle','Sain-Georges','Notre-Dame de-Lorette','Trinité dEstienne DOrves','Madeleine','Concorde','Assemblée Nationale','Solférino','Rue du Bac','Sévres Babylone','Rennes','Notre-Dame-des-Champs','Falguière','Pasteur','Volontaires','Vaugirard','Convention','Porte de Versailles','Corentin Celton','Marie dIssy']).

linha(13.1,['Châtillon-Montrouge','Malakoff Rue Étienne Dolet','Malakoff Plateau de Vanves','Porte de Vanves','Plaisance','Pernety','Gaîté','Gare Montparnasse','Duroc','Saint François Xavier','Varenne','Invalides','Champs Élysées Clemenceau','Miromesnil','Liège','Place de Clichy', 'La Fourge','Brochant','Porte de Clichy','Mairie de Clichy','Gabriel Péri','Les Agnettes','Les Courtillies']).

linha(13.2,['Châtillon-Montrouge','Malakoff Rue Étienne Dolet','Malakoff Plateau de Vanves','Porte de Vanves','Plaisance','Pernety','Gaîté','Gare Montparnasse','Duroc','Saint François Xavier','Varenne','Invalides','Champs Élysées Clemenceau','Miromesnil','Liège','Place de Clichy', 'La Fourge','Guy Môquet','Porte de Saint-Ouen','Garibaldi','Mairie de Saint-Ouen','Carrefour Pleyel','Saint-Denis Porte de Paris','Basilique de St-Denis','Saint-Denis-Université']).

linha(14,['Olympiades','Bibliothèque Fr. Mitterrand','Cour St-Émilion','Bercy','Gare dAusterlitz','Châtelet','Pyramides','Madeleine','Saint-Lazare']).

linha('A1',['Cergy','La Défense','Charles de Gaulle Êtoile','Auber','Les Halles','Gare dAusterlitz','Nation','Vincennes','Marne-la-Vallée']).

linha('A2',['Cergy','La Défense','Charles de Gaulle Êtoile','Auber','Les Halles','Gare dAusterlitz','Nation','Vincennes','Boissy-St-Lagger']).

linha('A3',['Poissy','La Défense','Charles de Gaulle Êtoile','Auber','Les Halles','Gare dAusterlitz','Nation','Vincennes','Marne-la-Vallée']).

linha('A4',['Poissy','La Défense','Charles de Gaulle Êtoile','Auber','Les Halles','Gare dAusterlitz','Nation','Vincennes','Boissy-St-Lagger']).

linha('A5',['St-Germain-en-Laye','La Défense','Charles de Gaulle Êtoile','Auber','Les Halles','Gare dAusterlitz','Nation','Vincennes','Marne-la-Vallée']).

linha('A6',['St-Germain-en-Laye','La Défense','Charles de Gaulle Êtoile','Auber','Les Halles','Gare dAusterlitz','Nation','Vincennes','Boissy-St-Lagger']).

linha('B1',['Robinson','Bourg-la-Reine','Bagneux','Arcueil-Cachan','Laplace','Gentilly','Cité Universitaire','Denfert Rochereau','Port-Royal','Luxembourg','St-Michel-Notre-Dame','Châtelet Les Halles','Gare du Nord','La Plaine Stade de France','La Courneuve Aubervilliers','Le Bourget','Mitry-Claye']).

linha('B2',['Saint-Rémy-les-Chevreuse','Antony','Buorg-la-Reine','Bagneux','Arcueil-Cachan','Laplace','Gentilly','Cité Universitaire','Denfert Rochereau','Port-Royal','Luxembourg','St-Michel-Notre-Dame','Châtelet Les Halles','Gare du Nord','La Plaine Stade de France','La Courneuve Aubervilliers','Le Bourget','Mitry-Claye']).

linha('B3',['Robinson','Bourg-la-Reine','Bagneux','Arcueil-Cachan','Laplace','Gentilly','Cité Universitaire','Denfert Rochereau','Port-Royal','Luxembourg','St-Michel-Notre-Dame','Châtelet Les Halles','Gare du Nord','La Plaine Stade de France','La Courneuve Aubervilliers','Le Bourget','Parc des Expositions','Aéroport Charles de Gaulle']).

linha('B4',['Saint-Rémy-les-Chevreuse','Antony','Bourg-la-Reine','Bagneux','Arcueil-Cachan','Laplace','Gentilly','Cité Universitaire','Denfert Rochereau','Port-Royal','Luxembourg','St-Michel-Notre-Dame','Châtelet Les Halles','Gare du Nord','La Plaine Stade de France','La Courneuve Aubervilliers','Le Bourget','Parc des Expositions','Aéroport Charles de Gaulle']).

linha('C1',['Massy-Palalseau Versailles-Chantlers','Choisy-le-Roi','Les Ardoines','Vitry sur-Seine','Ivry sur-Seine','Bibliothèque Fr. Mitterrand','Gare dAusterlitz','St-Michel Notre-Dame','Musée dOrsay','Invalides','Pont de lAlma','Champ de Mars Tour Eiffel','Javel','Pont du Gariliano','Issy Val de Seine','Issy','Meudon-Val-Fleury','Chaville-Véllizy','Viroflay Rive Gauche','Versailles-Château']).

linha('C2',['Dourdan Saint-Martin-dÉtampes','Choisy-le-Roi','Les Ardoines','Vitry sur-Seine','Ivry sur-Seine','Bibliothèque Fr. Mitterrand','Gare dAusterlitz','St-Michel Notre-Dame','Musée dOrsay','Invalides','Pont de lAlma','Champ de Mars Tour Eiffel','Javel','Pont du Gariliano','Issy Val de Seine','Issy','Meudon-Val-Fleury','Chaville-Véllizy','Viroflay Rive Gauche','Versailles-Château']).

linha('C3',['Massy-Palalseau Versailles-Chantlers','Choisy-le-Roi','Les Ardoines','Vitry sur-Seine','Ivry sur-Seine','Bibliothèque Fr. Mitterrand','Gare dAusterlitz','St-Michel Notre-Dame','Musée dOrsay','Invalides','Pont de lAlma','Champ de Mars Tour Eiffel','Avenue du Pdt Kennedy','Boulainvilliers','Avenue Henri Martin','Avenue Foch','Neuilly-Porte Maillot','Pereire-Levallois','Porte de Clichy','Saint Ouen','Les Grésillons','Pontoise']).

linha('C4',['Dourdan Saint-Martin-dÉtampes','Choisy-le-Roi','Les Ardoines','Vitry sur-Seine','Ivry sur-Seine','Bibliothèque Fr. Mitterrand','Gare dAusterlitz','St-Michel Notre-Dame','Musée dOrsay','Invalides','Pont de lAlma','Champ de Mars Tour Eiffel','Avenue du Pdt Kennedy','Boulainvilliers','Avenue Henri Martin','Avenue Foch','Neuilly-Porte Maillot','Pereire-Levallois','Porte de Clichy','Saint Ouen','Les Grésillons','Pontoise']).

linha('D1',['Malesherbes','Le Vert de Maisons','Maisons-Alfort Alfortville','Gare dAusterlitz','Les Halles','Gare du Nord','Stade de France Saint-Denis','Saint-Denis','Crell']).

linha('D2',['Melun','Le Vert de Maisons','Maisons-Alfort Alfortville','Gare dAusterlitz','Les Halles','Gare du Nord','Stade de France Saint-Denis','Saint-Denis','Crell']).

linha('E1',['Haussmann Saint-Lazare','Gare du Nord','Pantin','Noisy-le-Sec','Tournan']).

linha('E2',['Haussmann Saint-Lazare','Gare du Nord','Pantin','Noisy-le-Sec','Chelles Gournay']).

ponto_turistico('Torre Eiffel','Bir-Hakeim',30,'9:30','23:30').

ponto_turistico('Torre Eiffel','Trocadéro',30,'9:30','23:30').

ponto_turistico('Torre Eiffel','Champ de Mars Tour Eiffel',30,'9:30','23:30').

ponto_turistico('Arco do Triunfo','Charles de Gaulle Êtoile',25,'8:00','23:00').

ponto_turistico('Sacré Cour','Jules Joffrin',40,'6:00','10:30').

ponto_turistico('Sacré Cour','Pigalle',40,'6:00','10:30').

ponto_turistico('Sacré Cour','Abesses',40,'6:00','10:30').

ponto_turistico('Sacré Cour','Anvers',40,'6:00','10:30').

ponto_turistico('Louvre','Palais Royal Musée du Louvre',35,'9:00','18:00').

ponto_turistico('Catedral de Notre Dame','Cité',30,'8:00','18:45').

ponto_turistico('Catedral de Notre Dame','Saint-Michel',30,'8:00','18:45').

ponto_turistico('Catedral de Notre Dame','Hôtel de Ville',30,'8:00','18:45').

ponto_turistico('Catedral de Notre Dame','Maubert-Mutualité',30,'8:00','18:45').

ponto_turistico('Catedral de Notre Dame','Cluny-La Soborne',30,'8:00','18:45').

ponto_turistico('Catedral de Notre Dame','Châtelet',30,'8:00','18:45').

ponto_turistico('Catedral de Notre Dame','St-Michel-Notre-Dame',30,'8:00','18:45').

ponto_turistico('Grand Palais','Franklin-D. Roosevelt',40,'9:00','18:00').

ponto_turistico('Grand Palais','Champs-Elysées-Clemenceau',40,'9:00','18:00').

ponto_turistico('Grand Palais','Invalides',40,'9:00','18:00').

ponto_turistico('La Défense','La Défense',40,'9:00','18:00').

ponto_turistico('Stade de France','St Denis-Porte de Paris',45,'10:00','17:00').

ponto_turistico('Stade de France','La Plaine Stade de France',45,'10:00','17:00').

ponto_turistico('Stade de France','Stade de France St-Denis',45,'10:00','17:00').

ponto_turistico('La Conciergerie','Châtelet',30,'9:00','18:00').

ponto_turistico('La Conciergerie','Saint-Michel',30,'9:00','18:00').

ponto_turistico('La Conciergerie','Cité',30,'9:00','18:00').

ponto_turistico('Palácio de Versalhes','Château de Versailles Rive Gauche',50,'9:00','18:30').

ponto_turistico('Museu Grévin','Grands Boulevards',35,'10:00','19:00').

ponto_turistico('Jardim da Aclimatação','Les Sablons',20,'10:00','19:00').

ponto_turistico('Jardim das Plantas','Austerlitz',25,'7:30','20:00').

ponto_turistico('Jardim das Plantas','Censier Daubenton',25,'7:30','20:00').

ponto_turistico('Jardim das Plantas','Jussieu',25,'7:30','20:00').

ponto_turistico('Disneyland','Marne-la-Vallée',50,'10:00','22:00').

ponto_turistico('Museu de Arte Moderna','Rambuteau',45,'11:00','19:00').

ponto_turistico('Museu de Arte Moderna','Hôtel de Ville',45,'11:00','19:00').

ponto_turistico('Museu de Arte Moderna','Châtelet–Les Halles',45,'11:00','19:00').

ponto_turistico('Cidade das Ciências','Porte de la Villette',40,'9:00','17:00').

ponto_turistico('Tour Montparnasse','Montparnasse Bienvenue',30,'9:30','18:30').

ponto_turistico('Tour Montparnasse','Gare Montparnasse',30,'9:30','18:30').

ponto_turistico('Museu de Orsay','Solférino',55,'10:00','17:00').

ponto_turistico('Museu de Orsay','Musée dOrsay',55,'10:00','17:00').

ponto_turistico('Champs de Mars','École Militaire',40,'8:00','23:00').

% --------------------------------------------------------------------------------------------------------------------- %



%	Função para criar dinamicamente todas as estações de metro carregadas na base de conhecimento.

gera_estacoes:- findall(L, linha(_,L), LE), gera_estacoes(LE, Estacoes), assertz(estacoes(Estacoes)).
gera_estacoes([],[]).
gera_estacoes([H|T], LE):- gera_estacoes(T,LR), append(LR, H, LE).

% --------------------------------------------------------------------------------------------------------------------- %



%	Função para criar dinamicamente todos os cruzamentos entre linhas de metro e respectivas estações.

gera_cruzamentos:- findall(_,cruzamento,_).

cruzamento:- linha(N1,LE1), linha(N2,LE2), N1 \== N2, intersection(LE1,LE2,LI), LI \==[], assertz(cruzamento(N1,N2,LI)).

% --------------------------------------------------------------------------------------------------------------------- %



%	Funcão para criar dinamicamente factos do tipo liga(Linha, EstacaoOrigem, EstacaoFinal, Tempo).

gera_ligacoes:- findall(_, (linha(N,L), gera_ligacoes(N, L, L)), _).

gera_ligacoes(_, _, [_|[]]).
gera_ligacoes(N, [H|T], [H, H1|_]):- N == 10, !, gera_ligacoes(N, T, T), \+liga(H,H1,5), assertz(liga(H, H1, 5)).
gera_ligacoes(N, [H|T], [H, H1|_]):- N == 10.2, !, gera_ligacoes(N, T, T), \+liga(H,H1,5), assertz(liga(H1, H, 5)).
gera_ligacoes(N, [H|T], [H, H1|_]):- gera_ligacoes(N, T, T), \+liga(H,H1,5), assertz(liga(H, H1, 5)), \+liga(H1,H,5), assertz(liga(H1, H, 5)).

% --------------------------------------------------------------------------------------------------------------------- %

%	Função para encontrar o caminho mais rápido entre 2 estações

:- use_module(library(statistics)). % time/1

mais_rapido(Orig,Dest,Perc,Total):-
			estimativa(Orig,Dest,H), F is H + 0, % G = 0
			time((hbf1([c(F/0,[Orig])],Dest,P,Total),
			reverse(P,Perc))).

hbf1(Percursos,Dest,Percurso,Total):-
			menor_percurso(Percursos,Menor,Restantes),
			percursos_seguintes(Menor,Dest,Restantes,Percurso,Total).

percursos_seguintes(c(_/Dist,Percurso),Dest,_,Percurso,Dist):- Percurso=[Dest|_].

percursos_seguintes(c(_,[Dest|_]),Dest,Restantes,Percurso,Total):-!,
	hbf1(Restantes,Dest,Percurso,Total).

percursos_seguintes(c(_/Dist,[Ult|T]),Dest,Percursos,Percurso,Total):-
	findall(c(F1/D1,[Z,Ult|T]),proximo_no(Ult,T,Z,Dist,Dest,F1/D1),Lista),
	append(Lista,Percursos,NovosPercursos),
	hbf1(NovosPercursos,Dest,Percurso,Total).

proximo_no(X,T,Y,Dist,Dest,F/Dist1):-
				liga(X,Y,Z),
				\+ member(Y,T),
				Dist1 is Dist + Z,
				estimativa(Y,Dest,H), F is H + Dist1.

menor_percurso([H|Percurso], Menor, [H| Percurso1]):- 
menor_percurso(Percurso, Menor, Percurso1),
	menor(H,Menor),!.

menor_percurso([H|T],H,T).

menor(c(A1/B1,_), c(A2/B2,_)):- As1 is A1 + B1, As2 is A2 + B2, As2 < As1.

%estimativa(C1,C2,Est):-
%		cidade(C1,X1,Y1),
%		cidade(C2,X2,Y2),
%		DX is X1-X2,
%		DY is Y1-Y2,
%		Est is sqrt(DX*DX+DY*DY).

estimativa(_,_,0). % para desprezar a heurística.

% --------------------------------------------------------------------------------------------------------------------- %













